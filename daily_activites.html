<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Activity</title>

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <div id="navbar"></div>
    <script>
        fetch('navbar.html')
            .then(response => response.text())
            .then(data => document.getElementById('navbar').innerHTML = data);
    </script>

    <div class="page-wrapper">
        <section class="activity-form-section">
            <h2 class="section-title">
                <i class="fa-solid fa-person-running"></i> Log Your Activity
            </h2>

            <form id="activityForm" class="form-card">

                <div class="form-group">
                    <label for="activityType">Activity Type</label>
                    <select id="activityType" required>
                        <option value="Running">Running</option>
                        <option value="Cycling">Cycling</option>
                        <option value="Gym">Gym Session</option>
                        <option value="Swimming">Swimming</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="duration">Duration</label>
                    <select id="duration" required>
                        <option value="" disabled selected>Select duration</option>
                        <option value="15">15 minutes</option>
                        <option value="30">30 minutes</option>
                        <option value="45">45 minutes</option>
                        <option value="60">1 hour</option>
                        <option value="90">1.5 hours</option>
                        <option value="120">2 hours</option>
                        <option value="150">2.5 hours</option>
                        <option value="180">3 hours</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea id="notes" rows="4" placeholder="Add any notes... (optional)"></textarea>
                </div>

                <button type="submit" class="btn-primary">
                    <i class="fa-solid fa-check"></i> Save Activity
                </button>

            </form>
        </section>

        <section class="activities-section">
            <div class="activities-header">
                <h2 class="section-title">Recent Activities</h2>
                <a href="all_activities.html" class="see-more-link">See more &raquo;</a>
            </div>

            <div id="activitiesList" class="activities-container"></div>
        </section>
    </div>

    <script>
        function getActivityIcon(type) {
            const cleanType = type.trim().toLowerCase();

            const iconMap = {
                "workout": "fa-dumbbell",
                "running": "fa-person-running",
                "cycling": "fa-bicycle",
                "swimming": "fa-person-swimming",
                "walking": "fa-person-walking",
                "yoga": "fa-spa",
                "gym": "fa-heart-pulse",
            };

            return iconMap[cleanType] || "fa-clipboard-list";
        }

        async function displayRecentActivities() {
            const container = document.getElementById("activitiesList");
            if (!container) return;

            container.innerHTML = "";

            const activities = await loadAllActivities();

            if (activities.length === 0) {
                container.innerHTML = `<p class="no-activity-message">No activities recorded yet.</p>`;
                return;
            }

            const recentActivities = activities
                .sort((a, b) => new Date(b.startedAt) - new Date(a.startedAt))
                .slice(0, 5);

            recentActivities.forEach(a => {
                const icon = getActivityIcon(a.type);

                container.innerHTML += `
                <div class="activity-card">
                    <header class="card-header">
                    <div class="activity-header-left">
                        <i class="fa-solid ${icon} activity-icon"></i>
                        <span class="activity-title">${a.type}</span>
                    </div>
                    <span class="activity-date">
                        ${new Date(a.startedAt).toLocaleDateString('en-GB')}
                    </span>
                    </header>
                    <p><strong>Notes:</strong> ${a.notes || "None"}</p>
                </div>
                `;
            });
        }


        displayRecentActivities();


        const activityForm = document.getElementById("activityForm");

        if (activityForm) {
            activityForm.addEventListener("submit", function(event) {
                event.preventDefault();

                const activityType = document.getElementById("activityType").value;
                const duration = document.getElementById("duration").value;
                const notes = document.getElementById("notes").value;

                const activities = JSON.parse(localStorage.getItem("activities")) || [];

                const newActivity = {
                    activityType,
                    duration,
                    notes,
                    time: new Date().toISOString()  
                };

                activities.push(newActivity);
                localStorage.setItem("activities", JSON.stringify(activities));

              

                
                activityForm.reset();
                displayRecentActivities();

                
                localStorage.setItem("refreshActivities", "true");
            });
        }
    </script>

    <script type="module" src="app.js"></script>

</body>
</html>
